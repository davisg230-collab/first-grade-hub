<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hey Hey First Grade! - Mr. Davis's Class</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            display: ['"Poppins"','ui-sans-serif','system-ui'],
            body: ['"Inter"','ui-sans-serif','system-ui'],
          },
          colors: {
            brand: {
              mustard:'#E0B14A', slate:'#7B8E9E', coral:'#E9867D',
              blush:'#F2C9BE', cream:'#F7EFE2', pebble:'#E6D5B8',
              ink:'#2B2B2B', white:'#FFFFFF'
            }
          },
          boxShadow:{ soft:'0 10px 30px rgba(43,43,43,0.10)' }
        }
      }
    };
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBVFcyBYlz3DmCkOervIswwjPf6wwFZlhU",
      authDomain: "first-grade-news-hub.firebaseapp.com",
      projectId: "first-grade-news-hub",
      storageBucket: "first-grade-news-hub.appspot.com",
      messagingSenderId: "472215115326",
      appId: "1:472215115326:web:0d1f2cb7c1d5615676636f",
      measurementId: "G-5SF4RE6KLS"
    };
    firebase.initializeApp(firebaseConfig);
    try { firebase.analytics(); } catch (e) {}
    const db = firebase.firestore();
    const auth = firebase.auth();
    const storage = firebase.storage();
  </script>
  
  <style>
    :root{
      --md-mustard:#E0B14A; --md-slate:#7B8E9E; --md-coral:#E9867D;
      --md-blush:#F2C9BE; --md-cream:#F7EFE2; --md-pebble:#E6D5B8;
      --md-ink:#2B2B2B; --md-white:#FFFFFF;
      --hdr-bg: var(--md-mustard);
      --card-bg: var(--md-cream);
    }
    
    /* Modern Dark Mode Variables */
    body.dark {
      --md-mustard: #F4D03F; /* Lighter mustard for dark mode */
      --md-slate: #85929E; /* Lighter slate for dark mode */
      --md-coral: #F1948A; /* Lighter coral for dark mode */
      --md-blush: #F8C4B4; /* Lighter blush for dark mode */
      --md-cream: #1A1D23; /* Dark background for cards */
      --md-pebble: #C8B99C; /* Lighter pebble for dark mode */
      --md-ink: #E8E8E8; /* Light text for dark mode */
      --md-white: #2C3E50; /* Dark surface for dark mode */
      --hdr-bg: #2C3E50; /* Dark header background */
      --card-bg: #1A1D23; /* Dark card background */
    }
    .fade-in{opacity:0;transform:translateY(8px);transition:opacity .35s,transform .35s}
    .fade-in.visible{opacity:1;transform:translateY(0)}
    .pagePanel{display:none}
    .pagePanel.active{display:block}
    .edit-only{display:none!important}
    body.editing .edit-only{display:inline-flex!important}
    body.editing [data-edit="teacher"][contenteditable="true"]{outline:2px dashed color-mix(in oklab,var(--md-slate) 55%,transparent);outline-offset:4px;border-radius:.5rem}
    .teacher-only-edit:disabled { background-color: #f3f4f6; color: #9ca3af; cursor: not-allowed; }
    body.editing .teacher-only-edit:not(:disabled) {
      background-color: white; color: var(--md-ink); cursor: text;
      outline: 2px dashed color-mix(in oklab,var(--md-slate) 55%,transparent); outline-offset: 2px;
    }
    /* Photo card and gallery cursor only in edit mode */
    .photo-card{cursor: default;}
    body.editing .photo-card{cursor: pointer;}
    .gallery-imgs{cursor: default;}
    body.editing .gallery-imgs{cursor: pointer;}
    body.dark{background: #17212B; color: var(--md-ink);}
    body.dark .shadow-soft{box-shadow:0 10px 30px rgba(0,0,0,.5)}
    body.dark .bg-white { background: var(--md-white) !important; }
    body.dark .bg-yellow-50 { background: rgba(244, 208, 63, 0.1) !important; }
    body.dark .bg-blue-50 { background: rgba(133, 146, 158, 0.1) !important; }
    body.dark .bg-green-50 { background: rgba(125, 206, 160, 0.1) !important; }
    body.dark .border { border-color: rgba(232, 232, 232, 0.2) !important; }
    body.dark .text-gray-400 { color: #A0A0A0 !important; }
    #pinOverlay { display: none; }
    #pinOverlay.show { display: flex; }
    .pageTab.active, .pageTab.ring-4 { box-shadow: 0 0 0 3px #fff9; }
    .snack-claimed { background: #e0b14a33; }
    .gallery-arrows { position:absolute;top:50%;left:0;width:100%;display:flex;justify-content:space-between;align-items:center;pointer-events:none; }
    .gallery-arrows button { pointer-events:auto;border:none;background:rgba(255,255,255,.75);border-radius:50%;font-size:1.5rem;padding:0.25em 0.6em;cursor:pointer; }
    .gallery-imgs { position:relative;}
    .gallery-imgs img { width:100%; height:100%; object-fit:cover; border-radius:1rem;}
  </style>
</head>
<body class="bg-[color:var(--md-cream)] text-[color:var(--md-ink)] font-body">
  <!-- HEADER -->
  <header class="relative w-full" style="background: var(--hdr-bg);">
    <div class="max-w-6xl mx-auto px-6 py-10 sm:py-12">
      <h1 class="text-3xl sm:text-4xl lg:text-5xl font-display font-extrabold text-white">
        Hey Hey First Grade!
      </h1>
      <p id="weekText" class="mt-2 text-white/95 font-semibold"
         data-edit="teacher" contenteditable="false">Week of September 1‚Äì5</p>
      <div class="mt-6 flex flex-wrap items-center gap-3">
        <button id="toggleHighContrast"
                class="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-white text-[color:var(--md-ink)] font-semibold hover:opacity-90">
          <span>üåì</span><span>Light/Dark</span>
        </button>
        <a href="mailto:dgonzalezjr@crossroadsschoolskc.org"
           class="inline-flex items-center gap-2 px-4 py-2 rounded-xl text-white font-semibold hover:opacity-90"
           style="background: var(--md-coral);">
          <span>üìß</span><span>Contact Me</span>
        </a>
        <a id="classDojoBtn" href="https://classdojo.com" target="_blank"
           class="inline-flex items-center gap-2 px-4 py-2 rounded-xl text-white font-semibold hover:opacity-90"
           style="background:#6b7280;">
          <span>üéØ</span><span>ClassDojo</span>
        </a>
        <button class="pageTab inline-flex items-center gap-2 px-4 py-2 rounded-xl text-white font-semibold hover:opacity-90"
                data-page="transportation" style="background: var(--md-slate);">
          <span>üöå</span><span>Transportation</span>
        </button>
        <button class="pageTab inline-flex items-center gap-2 px-4 py-2 rounded-xl text-white font-semibold hover:opacity-90"
                data-page="aboutme" style="background: var(--md-coral);">
          <span>üë®‚Äçüè´</span><span>About Me</span>
        </button>
        <button class="pageTab inline-flex items-center gap-2 px-4 py-2 rounded-xl text-white font-semibold hover:opacity-90"
                data-page="birthdays" style="background: var(--md-coral);">
          <span>üéÇ</span><span>Birthdays</span>
        </button>
      </div>
    </div>
  </header>
  <!-- Tab Separator -->
  <div class="max-w-6xl mx-auto px-6">
    <div class="border-t border-gray-300 dark:border-gray-600" style="border-color: color-mix(in oklab, var(--md-slate) 40%, transparent);"></div>
  </div>
  <main class="max-w-6xl mx-auto px-6 pb-16">
    <nav id="tabs" class="mt-6 mb-4 flex flex-wrap gap-2">
      <button class="pageTab active ring-4 ring-white/40 px-4 py-2 rounded-xl font-semibold text-white"
              data-page="home" style="background: var(--md-coral);">Home</button>
      <button class="pageTab px-4 py-2 rounded-xl font-semibold text-white"
              data-page="scholar" style="background: var(--md-mustard);">Scholar</button>
      <button class="pageTab px-4 py-2 rounded-xl font-semibold text-white"
              data-page="skills" style="background: var(--md-slate);">Skills</button>
      <button class="pageTab px-4 py-2 rounded-xl font-semibold text-white"
              data-page="listening" style="background: var(--md-coral);">Listening & Learning</button>
      <button class="pageTab px-4 py-2 rounded-xl font-semibold text-[color:var(--md-ink)]"
              data-page="math" style="background: var(--md-blush);">Math</button>
      <button class="pageTab px-4 py-2 rounded-xl font-semibold text-white"
              data-page="extras" style="background:#6b7280;">Extras</button>
      <button class="pageTab px-4 py-2 rounded-xl font-semibold text-white"
              data-page="specials" style="background:#f59e0b;">Specials</button>
      <button class="pageTab px-4 py-2 rounded-xl font-semibold text-white"
              data-page="practice" style="background: var(--md-pebble); color: var(--md-ink);">Practice Websites</button>
    </nav>
    <!-- HOME TAB -->
    <section data-page-panel="home" class="pagePanel fade-in active">
      <!-- What We Did -->
      <div class="rounded-2xl shadow-soft p-6 sm:p-8 mb-8" style="background: var(--card-bg);">
        <h2 class="text-2xl font-display font-bold mb-5">What We Did This Week</h2>
        <div class="grid md:grid-cols-3 gap-6">
          <!-- 2 small + 1 large photo grid -->
          <div class="col-span-1 flex flex-col gap-4">
            <div class="grid grid-cols-2 gap-4 mb-4">
              <div class="photo-card rounded-xl aspect-[4/3] bg-[color:var(--md-blush)] flex items-center justify-center text-3xl font-bold" onclick="editPhoto(this)">+</div>
              <div class="photo-card rounded-xl aspect-[4/3] bg-[color:var(--md-blush)] flex items-center justify-center text-3xl font-bold" onclick="editPhoto(this)">+</div>
            </div>
            <div class="photo-card rounded-xl aspect-[4/3] bg-[color:var(--md-blush)] flex items-center justify-center text-3xl font-bold" onclick="editPhoto(this)">+</div>
          </div>
          <!-- Editable recap -->
          <div class="md:col-span-2">
            <div class="rounded-xl p-4 sm:p-5 h-full flex items-center" style="background: color-mix(in oklab, var(--md-white) 70%, var(--md-blush) 30%); border: 1px solid color-mix(in oklab, var(--md-blush) 60%, var(--md-white) 40%);">
              <p id="recapText" class="leading-relaxed w-full" data-edit="teacher" contenteditable="false">
                This week we explored magical stories and practiced our sight words. The students loved reading about brave characters and sharing their favorite parts! We also worked on counting by 5s and 10s using fun games and manipulatives. Our art projects focused on fall colors and textures - the students created beautiful leaf collages and practiced writing descriptive words.
              </p>
            </div>
          </div>
        </div>
      </div>
      <!-- Important Dates + Looking Ahead -->
      <div class="rounded-2xl shadow-soft p-6 sm:p-8 mb-8" style="background: var(--card-bg);">
        <div class="grid md:grid-cols-3 gap-6">
          <div class="md:col-span-2">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-2xl font-display font-bold">Important Dates</h2>
              <button class="edit-only px-4 py-2 rounded-xl text-white font-semibold" style="background: var(--md-coral);" onclick="addEvent()">+ Add Event</button>
            </div>
            <div id="eventsList" class="space-y-4">
              <div class="event-item flex items-center gap-3 p-3 rounded-xl bg-yellow-50 border" style="border-color:var(--md-mustard)">
                <span class="event-emoji text-xl" data-edit="teacher" contenteditable="false">üéÉ</span>
                <span class="event-text font-semibold flex-1" data-edit="teacher" contenteditable="false">Halloween Party - October 31st at 2pm</span>
                <button class="edit-only text-red-500 hover:text-red-700" onclick="this.parentNode.remove()">‚úñ</button>
              </div>
              <div class="event-item flex items-center gap-3 p-3 rounded-xl bg-blue-50 border" style="border-color:var(--md-slate)">
                <span class="event-emoji text-xl" data-edit="teacher" contenteditable="false">ü¶É</span>
                <span class="event-text font-semibold flex-1" data-edit="teacher" contenteditable="false">Thanksgiving Break - November 23-27</span>
                <button class="edit-only text-red-500 hover:text-red-700" onclick="this.parentNode.remove()">‚úñ</button>
              </div>
            </div>
            <div class="p-4 rounded-xl mt-6" style="background: color-mix(in oklab, var(--md-white) 70%, #8b5cf6 30%); border: 1px solid color-mix(in oklab, #8b5cf6 60%, var(--md-white) 40%);">
              <h3 class="font-semibold mb-2">üìÖ School Calendar</h3>
              <a id="schoolCalendarLink" href="#" class="text-sm text-blue-600 hover:text-blue-800 underline" onclick="editSchoolCalendarLink(event, this)">View School Calendar</a>
              <p class="text-xs text-gray-600 mt-1">Click to visit the school calendar</p>
            </div>
          </div>
          <div>
            <div class="rounded-2xl p-5 h-full" style="background: color-mix(in oklab, var(--md-white) 68%, var(--md-blush) 32%); border: 1px solid color-mix(in oklab, var(--md-blush) 60%, var(--md-white) 40%);">
              <h3 class="font-semibold mb-3">üîÆ Looking Ahead</h3>
              <ul class="space-y-2 text-sm" data-edit="teacher" contenteditable="false">
                <li>‚Ä¢ Field trip permission slips due</li>
                <li>‚Ä¢ Parent-teacher conferences</li>
                <li>‚Ä¢ Winter concert practice begins</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <!-- Snack Helpers -->
      <div class="rounded-2xl shadow-soft p-6 sm:p-8 mb-8" style="background: var(--card-bg);">
        <div class="flex items-center justify-between mb-5">
          <div>
            <h2 class="text-2xl font-display font-bold">ü•® Snack Helpers</h2>
            <p class="text-sm text-[color:var(--md-ink)]/80 mt-1">Check an item and add your name.</p>
          </div>
          <button id="snackAdd" class="px-3 py-2 rounded-lg text-white" style="background: var(--md-coral);" onclick="addSnackItem()">+ Add other snack</button>
        </div>
        <div id="snacksGrid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
          <div class="p-4 rounded-xl bg-white" style="border: 1px solid color-mix(in oklab, var(--md-slate) 35%, var(--md-white) 65%);">
            <div class="flex items-center gap-3 mb-3">
              <input type="checkbox" class="w-4 h-4 snack-check">
              <span class="text-xl">üçé</span>
              <span class="font-medium">Apple slices</span>
            </div>
            <div class="flex items-center gap-2">
              <input type="text" placeholder="Your name" class="flex-1 px-3 py-2 rounded-lg text-sm snack-name" style="background: var(--md-cream);">
              <button class="px-3 py-2 rounded-lg text-white text-sm font-semibold" style="background: var(--md-coral);" onclick="claimSnack(this)">Save</button>
              <button class="text-gray-400 hover:text-red-500" onclick="this.closest('.p-4').remove()">‚úñ</button>
            </div>
          </div>
          <div class="p-4 rounded-xl bg-white" style="border: 1px solid color-mix(in oklab, var(--md-slate) 35%, var(--md-white) 65%);">
            <div class="flex items-center gap-3 mb-3">
              <input type="checkbox" class="w-4 h-4 snack-check">
              <span class="text-xl">ü•®</span>
              <span class="font-medium">Pretzels</span>
            </div>
            <div class="flex items-center gap-2">
              <input type="text" placeholder="Your name" class="flex-1 px-3 py-2 rounded-lg text-sm snack-name" style="background: var(--md-cream);">
              <button class="px-3 py-2 rounded-lg text-white text-sm font-semibold" style="background: var(--md-coral);" onclick="claimSnack(this)">Save</button>
              <button class="text-gray-400 hover:text-red-500" onclick="this.closest('.p-4').remove()">‚úñ</button>
            </div>
          </div>
          <div class="p-4 rounded-xl bg-white" style="border: 1px solid color-mix(in oklab, var(--md-slate) 35%, var(--md-white) 65%);">
            <div class="flex items-center gap-3 mb-3">
              <input type="checkbox" class="w-4 h-4 snack-check">
              <span class="text-xl">üßÄ</span>
              <span class="font-medium">Cheese sticks</span>
            </div>
            <div class="flex items-center gap-2">
              <input type="text" placeholder="Your name" class="flex-1 px-3 py-2 rounded-lg text-sm snack-name" style="background: var(--md-cream);">
              <button class="px-3 py-2 rounded-lg text-white text-sm font-semibold" style="background: var(--md-coral);" onclick="claimSnack(this)">Save</button>
              <button class="text-gray-400 hover:text-red-500" onclick="this.closest('.p-4').remove()">‚úñ</button>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- SCHOLAR TAB -->
    <section data-page-panel="scholar" class="pagePanel fade-in">
      <div class="rounded-2xl shadow-soft p-6 sm:p-10 mb-8" style="background: var(--md-white); border: 1px solid color-mix(in oklab, var(--md-mustard) 50%, var(--md-white) 50%);">
        <div class="grid lg:grid-cols-[auto,1fr] gap-8 items-center">
          <div class="w-40 h-40 sm:w-48 sm:h-48 rounded-full border-4 img-frame photo-card overflow-hidden mx-auto lg:mx-0" 
               style="border-color: var(--md-mustard);" onclick="editProfilePhoto(this, 'scholar')"></div>
          <div class="text-center lg:text-left relative">
            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full mb-4" style="background: color-mix(in oklab, var(--md-mustard) 25%, var(--md-white));">
              <span>üåü</span>
              <span class="text-sm font-semibold">Scholar of the Week</span>
            </div>
            <h3 class="text-3xl sm:text-4xl font-display font-extrabold mb-4" data-edit="teacher" contenteditable="false">Emma S.</h3>
            <p class="text-lg leading-relaxed mb-6" data-edit="teacher" contenteditable="false">
              Emma has shown incredible kindness this week by helping her classmates and always having a positive attitude. She's been working so hard on her reading and it really shows!
            </p>
            <button id="celebrateBtn" onclick="triggerConfetti()" 
                    class="inline-flex items-center gap-2 px-6 py-3 rounded-xl font-semibold text-white" 
                    style="background: var(--md-coral);">
              <span>üéâ</span><span>Celebrate!</span>
            </button>
          </div>
        </div>
      </div>
    </section>
    <!-- SKILLS TAB -->
    <section data-page-panel="skills" class="pagePanel fade-in">
      <div class="rounded-2xl shadow-soft p-6 sm:p-8 mb-8" style="background: var(--card-bg);">
        <h2 class="text-2xl font-display font-bold mb-4" style="color: var(--md-coral);">üìñ Skills Spotlight</h2>
        <div class="grid md:grid-cols-3 gap-6">
          <div class="md:col-span-2">
            <p class="leading-relaxed" data-edit="teacher" contenteditable="false">
              This week we're focusing on building strong reading foundations through sight word recognition and phonics practice. Students are learning to blend sounds together to read new words and are practicing writing complete sentences with proper capitalization and punctuation.
            </p>
          </div>
          <div class="rounded-xl p-4" style="background: color-mix(in oklab, var(--md-white) 70%, var(--md-coral) 30%); border: 1px solid color-mix(in oklab, var(--md-coral) 60%, var(--md-white) 40%);">
            <h3 class="font-semibold mb-3">Sounds / Sight Words / Vocab</h3>
            <ul class="text-sm list-disc pl-5" data-edit="teacher" contenteditable="true">
              <li>Short vowel sounds</li>
              <li>Words: the, and, is, to</li>
              <li>Family vocabulary</li>
              <li>Action words</li>
            </ul>
          </div>
        </div>
      </div>
    </section>
    <!-- LISTENING & LEARNING TAB -->
    <section data-page-panel="listening" class="pagePanel fade-in">
      <div class="rounded-2xl shadow-soft p-6 sm:p-8 mb-8" style="background: var(--card-bg);">
        <h2 class="text-2xl font-display font-bold mb-4" style="color: var(--md-coral);">üëÇ Listening & Learning</h2>
        <div class="grid md:grid-cols-3 gap-6">
          <div class="md:col-span-2">
            <p class="leading-relaxed" data-edit="teacher" contenteditable="false">
              We're building strong listening skills through daily read-alouds and interactive discussions. Students practice following multi-step directions and learn to ask thoughtful questions about the stories we read together.
            </p>
          </div>
          <div class="rounded-xl p-4" style="background: color-mix(in oklab, var(--md-white) 70%, var(--md-coral) 30%); border: 1px solid color-mix(in oklab, var(--md-coral) 60%, var(--md-white) 40%);">
            <h3 class="font-semibold mb-3">Ask your scholar...</h3>
            <ul class="text-sm list-disc pl-5" data-edit="teacher" contenteditable="true">
              <li>What happened in today's story?</li>
              <li>Who was your favorite character?</li>
              <li>What do you think happens next?</li>
            </ul>
          </div>
        </div>
      </div>
    </section>
    <!-- MATH TAB -->
    <section data-page-panel="math" class="pagePanel fade-in">
      <div class="rounded-2xl shadow-soft p-6 sm:p-8 mb-8" style="background: var(--card-bg);">
        <div class="flex items-center justify-between mb-5">
          <h2 class="text-2xl font-display font-bold" style="color: var(--md-slate);">üßÆ Math Adventures</h2>
          <p class="text-sm text-[color:var(--md-ink)]/80">This week in math</p>
        </div>
        <div class="grid md:grid-cols-3 gap-6">
          <div class="md:col-span-2">
            <p class="leading-relaxed" data-edit="teacher" contenteditable="false">
              We're exploring number patterns and building addition skills using hands-on manipulatives and fun games. Students are learning to count by 2s, 5s, and 10s while practicing addition facts within 20.
            </p>
          </div>
          <div class="rounded-xl p-4" style="background: color-mix(in oklab, var(--md-white) 70%, var(--md-blush) 30%); border: 1px solid color-mix(in oklab, var(--md-blush) 60%, var(--md-white) 40%);">
            <h3 class="font-semibold mb-3">Vocabulary & Strategies</h3>
            <ul class="text-sm list-disc pl-5" data-edit="teacher" contenteditable="true">
              <li>Addition, sum, plus</li>
              <li>Count on strategy</li>
              <li>Number line</li>
              <li>Ten frames</li>
            </ul>
          </div>
        </div>
      </div>
    </section>
    <!-- EXTRAS TAB -->
    <section data-page-panel="extras" class="pagePanel fade-in">
      <div class="rounded-2xl shadow-soft p-6 sm:p-8" style="background: var(--card-bg);">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-display font-bold" style="color: var(--md-coral);">‚ú® Classroom Updates</h2>
          <div class="edit-only flex gap-2">
            <button id="addExtrasCardBtn" class="px-3 py-2 rounded-lg text-white text-sm" style="background: var(--md-coral);" onclick="addExtrasCard()">+ Add Card</button>
          </div>
        </div>
        <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6" id="extrasGrid">
          <div class="text-center p-8 rounded-2xl" style="background: color-mix(in oklab, var(--md-white) 70%, var(--md-mustard) 30%); border: 1px solid color-mix(in oklab, var(--md-mustard) 60%, var(--md-white) 40%);">
            <div class="text-6xl mb-4 emoji-edit" data-edit="teacher" contenteditable="false">üéØ</div>
            <h3 class="font-semibold mb-2" data-edit="teacher" contenteditable="false">Class Goal</h3>
            <p class="text-sm" data-edit="teacher" contenteditable="false">We're working together to read 100 books this month!</p>
          </div>
          <div class="text-center p-8 rounded-2xl" style="background: color-mix(in oklab, var(--md-white) 70%, var(--md-coral) 30%); border: 1px solid color-mix(in oklab, var(--md-coral) 60%, var(--md-white) 40%);">
            <div class="text-6xl mb-4 emoji-edit" data-edit="teacher" contenteditable="false">üì£</div>
            <h3 class="font-semibold mb-2" data-edit="teacher" contenteditable="false">Shout-outs</h3>
            <p class="text-sm" data-edit="teacher" contenteditable="false">Amazing job on our math assessments this week!</p>
          </div>
        </div>
      </div>
    </section>
    <!-- SPECIALS TAB -->
    <section data-page-panel="specials" class="pagePanel fade-in">
      <div class="rounded-2xl shadow-soft p-6 sm:p-8 mb-8" style="background: var(--card-bg);">
        <h2 class="text-2xl font-display font-bold mb-6" style="color: #f59e0b;">üé® Specials Classes</h2>
        <div class="grid md:grid-cols-2 gap-8">
          <!-- Art -->
          <div class="rounded-2xl overflow-hidden relative" style="background: color-mix(in oklab, var(--md-white) 70%, #ef4444 30%); border: 1px solid color-mix(in oklab, #ef4444 60%, var(--md-white) 40%);">
            <div class="gallery-imgs aspect-[4/3] bg-white m-4 flex items-center justify-center relative" onclick="editGalleryPhoto(this, 'art')" data-gallery-type="art">
              <img src="" alt="Art Gallery" style="display:none;">
              <span class="text-3xl text-gray-400">+</span>
              <span class="gallery-arrows">
                <button onclick="prevGalleryImg(this)">‚Äπ</button>
                <button onclick="nextGalleryImg(this)">‚Ä∫</button>
              </span>
            </div>
            <div class="rounded-lg p-4 m-4 bg-white" style="color: var(--md-ink);">
              <h3 class="font-semibold">üé® Art</h3>
              <p class="text-sm" data-edit="teacher" contenteditable="false">Creative masterpieces from art class</p>
            </div>
          </div>
          <!-- STEM -->
          <div class="rounded-2xl overflow-hidden relative" style="background: color-mix(in oklab, var(--md-white) 70%, #10b981 30%); border: 1px solid color-mix(in oklab, #10b981 60%, var(--md-white) 40%);">
            <div class="gallery-imgs aspect-[4/3] bg-white m-4 flex items-center justify-center relative" onclick="editGalleryPhoto(this, 'stem')" data-gallery-type="stem">
              <img src="" alt="STEM Gallery" style="display:none;">
              <span class="text-3xl text-gray-400">+</span>
              <span class="gallery-arrows">
                <button onclick="prevGalleryImg(this)">‚Äπ</button>
                <button onclick="nextGalleryImg(this)">‚Ä∫</button>
              </span>
            </div>
            <div class="rounded-lg p-4 m-4 bg-white" style="color: var(--md-ink);">
              <h3 class="font-semibold">üî¨ STEM</h3>
              <p class="text-sm" data-edit="teacher" contenteditable="false">Science experiments and discoveries</p>
            </div>
          </div>
          <!-- Gym -->
          <div class="rounded-2xl overflow-hidden relative" style="background: color-mix(in oklab, var(--md-white) 70%, #3b82f6 30%); border: 1px solid color-mix(in oklab, #3b82f6 60%, var(--md-white) 40%);">
            <div class="gallery-imgs aspect-[4/3] bg-white m-4 flex items-center justify-center relative" onclick="editGalleryPhoto(this, 'gym')" data-gallery-type="gym">
              <img src="" alt="Gym Gallery" style="display:none;">
              <span class="text-3xl text-gray-400">+</span>
              <span class="gallery-arrows">
                <button onclick="prevGalleryImg(this)">‚Äπ</button>
                <button onclick="nextGalleryImg(this)">‚Ä∫</button>
              </span>
            </div>
            <div class="rounded-lg p-4 m-4 bg-white" style="color: var(--md-ink);">
              <h3 class="font-semibold">üèÉ‚Äç‚ôÇÔ∏è Gym</h3>
              <p class="text-sm" data-edit="teacher" contenteditable="false">Physical activities and games</p>
            </div>
          </div>
          <!-- Music -->
          <div class="rounded-2xl overflow-hidden relative" style="background: color-mix(in oklab, var(--md-white) 70%, #8b5cf6 30%); border: 1px solid color-mix(in oklab, #8b5cf6 60%, var(--md-white) 40%);">
            <div class="gallery-imgs aspect-[4/3] bg-white m-4 flex items-center justify-center relative" onclick="editGalleryPhoto(this, 'music')" data-gallery-type="music">
              <img src="" alt="Music Gallery" style="display:none;">
              <span class="text-3xl text-gray-400">+</span>
              <span class="gallery-arrows">
                <button onclick="prevGalleryImg(this)">‚Äπ</button>
                <button onclick="nextGalleryImg(this)">‚Ä∫</button>
              </span>
            </div>
            <div class="rounded-lg p-4 m-4 bg-white" style="color: var(--md-ink);">
              <h3 class="font-semibold">üéµ Music</h3>
              <p class="text-sm" data-edit="teacher" contenteditable="false">Songs and musical learning</p>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- PRACTICE WEBSITES TAB -->
    <section data-page-panel="practice" class="pagePanel fade-in">
      <div class="rounded-2xl shadow-soft p-6 sm:p-8 mb-8" style="background: var(--md-cream);">
        <div class="flex items-center justify-between mb-5">
          <h2 class="text-2xl font-display font-bold" style="color: var(--md-slate);">üåê Practice Websites</h2>
        </div>
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          <div class="website-card text-center p-6 rounded-xl bg-white" style="border: 1px solid color-mix(in oklab, var(--md-slate) 60%, var(--md-white) 40%);">
            <div class="text-4xl mb-3" data-edit="teacher" contenteditable="false">üì±</div>
            <h3 class="website-title font-semibold mb-2" data-edit="teacher" contenteditable="false">ClassDojo</h3>
            <a href="https://classdojo.com" target="_blank" class="website-link inline-block px-4 py-2 rounded-lg font-semibold text-white text-sm" style="background: var(--md-slate);">Visit Site</a>
            <input type="url" class="edit-only mt-2 w-full px-3 py-2 text-sm border rounded-lg website-url-input" placeholder="Enter website URL" value="https://classdojo.com" onchange="updateWebsiteUrl(this)">
          </div>
          <div class="website-card text-center p-6 rounded-xl bg-white" style="border: 1px solid color-mix(in oklab, var(--md-mustard) 60%, var(--md-white) 40%);">
            <div class="text-4xl mb-3" data-edit="teacher" contenteditable="false">üéØ</div>
            <h3 class="website-title font-semibold mb-2" data-edit="teacher" contenteditable="false">Clever ‚Äì Learning Portal</h3>
            <a href="https://clever.com" target="_blank" class="website-link inline-block px-4 py-2 rounded-lg font-semibold text-white text-sm" style="background: var(--md-mustard);">Visit Site</a>
            <input type="url" class="edit-only mt-2 w-full px-3 py-2 text-sm border rounded-lg website-url-input" placeholder="Enter website URL" value="https://clever.com" onchange="updateWebsiteUrl(this)">
          </div>
          <div class="website-card text-center p-6 rounded-xl bg-white" style="border: 1px solid color-mix(in oklab, var(--md-coral) 60%, var(--md-white) 40%);">
            <div class="text-4xl mb-3" data-edit="teacher" contenteditable="false">üìò</div>
            <h3 class="website-title font-semibold mb-2" data-edit="teacher" contenteditable="false">Math Practice</h3>
            <a href="https://mathplayground.com" target="_blank" class="website-link inline-block px-4 py-2 rounded-lg font-semibold text-white text-sm" style="background: var(--md-coral);">Visit Site</a>
            <input type="url" class="edit-only mt-2 w-full px-3 py-2 text-sm border rounded-lg website-url-input" placeholder="Enter website URL" value="https://mathplayground.com" onchange="updateWebsiteUrl(this)">
          </div>
          <div class="website-card text-center p-6 rounded-xl bg-white" style="border: 1px solid color-mix(in oklab, var(--md-blush) 60%, var(--md-white) 40%);">
            <div class="text-4xl mb-3" data-edit="teacher" contenteditable="false">üìö</div>
            <h3 class="website-title font-semibold mb-2" data-edit="teacher" contenteditable="false">Skills Practice</h3>
            <a href="https://readingeggs.com" target="_blank" class="website-link inline-block px-4 py-2 rounded-lg font-semibold" style="background: var(--md-blush); color: var(--md-ink);">Visit Site</a>
            <input type="url" class="edit-only mt-2 w-full px-3 py-2 text-sm border rounded-lg website-url-input" placeholder="Enter website URL" value="https://readingeggs.com" onchange="updateWebsiteUrl(this)">
          </div>
          <div class="website-card text-center p-6 rounded-xl bg-white" style="border: 1px solid color-mix(in oklab, var(--md-pebble) 60%, var(--md-white) 40%);">
            <div class="text-4xl mb-3" data-edit="teacher" contenteditable="false">üî§</div>
            <h3 class="website-title font-semibold mb-2" data-edit="teacher" contenteditable="false">Blending Practice</h3>
            <a href="https://starfall.com" target="_blank" class="website-link inline-block px-4 py-2 rounded-lg font-semibold text-sm" style="background: var(--md-pebble); color: var(--md-ink);">Visit Site</a>
            <input type="url" class="edit-only mt-2 w-full px-3 py-2 text-sm border rounded-lg website-url-input" placeholder="Enter website URL" value="https://starfall.com" onchange="updateWebsiteUrl(this)">
          </div>
        </div>
      </div>
    </section>
    <!-- TRANSPORTATION TAB (always editable) -->
    <section data-page-panel="transportation" class="pagePanel fade-in">
      <div class="rounded-2xl shadow-soft p-6 sm:p-8 mb-8" style="background: var(--md-cream);">
        <h2 class="text-2xl font-display font-bold mb-6" style="color: #f59e0b;">üöå Transportation</h2>
        <div class="space-y-6">
          <div class="bg-white rounded-xl p-6" style="border: 1px solid color-mix(in oklab, var(--md-slate) 35%, var(--md-white) 65%);">
            <h3 class="text-lg font-semibold mb-4">üöå Bus Riders</h3>
            <textarea class="w-full h-32 p-3 text-sm border rounded-lg resize-none" placeholder="Student Name
Bus Number"></textarea>
          </div>
          <div class="bg-white rounded-xl p-6" style="border: 1px solid color-mix(in oklab, var(--md-slate) 35%, var(--md-white) 65%);">
            <h3 class="text-lg font-semibold mb-4">üöó Car Riders</h3>
            <textarea class="w-full h-32 p-3 text-sm border rounded-lg resize-none"></textarea>
          </div>
          <div class="bg-white rounded-xl p-6" style="border: 1px solid color-mix(in oklab, var(--md-slate) 35%, var(--md-white) 65%);">
            <h3 class="text-lg font-semibold mb-4">üè† Porch Pickup</h3>
            <textarea class="w-full h-32 p-3 text-sm border rounded-lg resize-none"></textarea>
          </div>
        </div>
      </div>
    </section>
    <!-- ABOUT ME TAB -->
    <section data-page-panel="aboutme" class="pagePanel fade-in">
      <div class="rounded-2xl shadow-soft p-6 sm:p-10 mb-8" style="background: var(--md-cream);">
        <div class="grid md:grid-cols-[auto,1fr] gap-8 items-center">
          <div class="w-40 h-40 sm:w-48 sm:h-48 rounded-full border-4 img-frame photo-card overflow-hidden mx-auto md:mx-0" 
               style="border-color: var(--md-mustard);" onclick="editProfilePhoto(this, 'aboutme')"></div>
          <div>
            <h2 class="text-2xl font-display font-bold mb-6" style="color: var(--md-coral);">üëã About Mr. Davis</h2>
            <div class="mb-6">
              <h3 class="font-semibold mb-3">About Me</h3>
              <p class="leading-relaxed" data-edit="teacher" contenteditable="false">
                I've been teaching first grade for 8 years and absolutely love working with young learners! I believe every child can succeed with the right support and encouragement.
              </p>
            </div>
            <div class="mb-6">
              <h3 class="font-semibold mb-3">Fun Facts</h3>
              <ul class="list-disc pl-5 space-y-1" data-edit="teacher" contenteditable="false">
                <li>I love reading mystery novels</li>
                <li>I have two cats named Whiskers and Mittens</li>
                <li>I enjoy hiking on weekends</li>
                <li>I can play the guitar</li>
              </ul>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
              <div class="bg-white rounded-xl p-4 text-center">
                <div class="text-2xl mb-2">üé®</div>
                <h4 class="font-semibold text-sm mb-1">Favorite Color</h4>
                <p class="text-xs" data-edit="teacher" contenteditable="false">Blue</p>
              </div>
              <div class="bg-white rounded-xl p-4 text-center">
                <div class="text-2xl mb-2">üç™</div>
                <h4 class="font-semibold text-sm mb-1">Favorite Snack</h4>
                <p class="text-xs" data-edit="teacher" contenteditable="false">Cookies</p>
              </div>
              <div class="bg-white rounded-xl p-4 text-center">
                <div class="text-2xl mb-2">ü•§</div>
                <h4 class="font-semibold text-sm mb-1">Favorite Drink</h4>
                <p class="text-xs" data-edit="teacher" contenteditable="false">Coffee</p>
              </div>
              <div class="bg-white rounded-xl p-4 text-center">
                <div class="text-2xl mb-2">üì∫</div>
                <h4 class="font-semibold text-sm mb-1">Favorite Show</h4>
                <p class="text-xs" data-edit="teacher" contenteditable="false">The Office</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- BIRTHDAYS TAB -->
    <section data-page-panel="birthdays" class="pagePanel fade-in">
      <h2 class="text-2xl font-display font-bold mb-6" style="color: var(--md-coral);">üéÇ Class Roster & Birthdays</h2>
      <div class="rounded-2xl shadow-soft p-6 sm:p-8 mb-8 bg-white" style="border: 1px solid color-mix(in oklab, var(--md-slate) 35%, var(--md-white) 65%);">
        <h3 class="text-xl font-semibold mb-5">üë• Class Roster</h3>
        <textarea class="w-full h-40 p-4 text-sm border rounded-lg resize-none teacher-only-edit" disabled placeholder="‚Ä¢ Type your student names here...
‚Ä¢ One student per line
‚Ä¢ Use bullet points or dashes">‚Ä¢ Emma S.
‚Ä¢ Jake M.
‚Ä¢ Sarah L.
‚Ä¢ Alex R.
‚Ä¢ Mia K.
‚Ä¢ Noah T.</textarea>
      </div>
      <div class="rounded-2xl shadow-soft p-6 sm:p-8" style="background: var(--md-cream);">
        <h3 class="text-xl font-semibold mb-5">üéÇ Birthday Calendar</h3>
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
          <div class="birthday-month bg-white rounded-xl p-4" style="border: 1px solid color-mix(in oklab, var(--md-blush) 60%, var(--md-white) 40%);">
            <h4 class="font-semibold mb-3">‚ùÑÔ∏è January</h4>
            <textarea class="w-full h-20 p-2 text-sm border rounded resize-none teacher-only-edit" disabled placeholder="Enter birthdays..."></textarea>
          </div>
          <div class="birthday-month bg-white rounded-xl p-4" style="border: 1px solid color-mix(in oklab, var(--md-coral) 60%, var(--md-white) 40%);">
            <h4 class="font-semibold mb-3">üíï February</h4>
            <textarea class="w-full h-20 p-2 text-sm border rounded resize-none teacher-only-edit" disabled placeholder="Enter birthdays..."></textarea>
          </div>
          <div class="birthday-month bg-white rounded-xl p-4" style="border: 1px solid color-mix(in oklab, var(--md-mustard) 60%, var(--md-white) 40%);">
            <h4 class="font-semibold mb-3">üå∏ March</h4>
            <textarea class="w-full h-20 p-2 text-sm border rounded resize-none teacher-only-edit" disabled placeholder="Enter birthdays..."></textarea>
          </div>
          <div class="birthday-month bg-white rounded-xl p-4" style="border: 1px solid color-mix(in oklab, var(--md-slate) 60%, var(--md-white) 40%);">
            <h4 class="font-semibold mb-3">üå∑ April</h4>
            <textarea class="w-full h-20 p-2 text-sm border rounded resize-none teacher-only-edit" disabled placeholder="Enter birthdays..."></textarea>
          </div>
          <div class="birthday-month bg-white rounded-xl p-4" style="border: 1px solid color-mix(in oklab, var(--md-pebble) 60%, var(--md-white) 40%);">
            <h4 class="font-semibold mb-3">üå∫ May</h4>
            <textarea class="w-full h-20 p-2 text-sm border rounded resize-none teacher-only-edit" disabled placeholder="Enter birthdays..."></textarea>
          </div>
          <div class="birthday-month bg-white rounded-xl p-4" style="border: 1px solid color-mix(in oklab, var(--md-coral) 60%, var(--md-white) 40%);">
            <h4 class="font-semibold mb-3">‚òÄÔ∏è June</h4>
            <textarea class="w-full h-20 p-2 text-sm border rounded resize-none teacher-only-edit" disabled placeholder="Enter birthdays..."></textarea>
          </div>
          <div class="birthday-month bg-white rounded-xl p-4" style="border: 1px solid color-mix(in oklab, var(--md-mustard) 60%, var(--md-white) 40%);">
            <h4 class="font-semibold mb-3">üèñÔ∏è July</h4>
            <textarea class="w-full h-20 p-2 text-sm border rounded resize-none teacher-only-edit" disabled placeholder="Enter birthdays..."></textarea>
          </div>
          <div class="birthday-month bg-white rounded-xl p-4" style="border: 1px solid color-mix(in oklab, var(--md-blush) 60%, var(--md-white) 40%);">
            <h4 class="font-semibold mb-3">üåª August</h4>
            <textarea class="w-full h-20 p-2 text-sm border rounded resize-none teacher-only-edit" disabled placeholder="Enter birthdays..."></textarea>
          </div>
          <div class="birthday-month bg-white rounded-xl p-4" style="border: 1px solid color-mix(in oklab, var(--md-slate) 60%, var(--md-white) 40%);">
            <h4 class="font-semibold mb-3">üçé September</h4>
            <textarea class="w-full h-20 p-2 text-sm border rounded resize-none teacher-only-edit" disabled placeholder="Enter birthdays..."></textarea>
          </div>
          <div class="birthday-month bg-white rounded-xl p-4" style="border: 1px solid color-mix(in oklab, var(--md-pebble) 60%, var(--md-white) 40%);">
            <h4 class="font-semibold mb-3">üçÇ October</h4>
            <textarea class="w-full h-20 p-2 text-sm border rounded resize-none teacher-only-edit" disabled placeholder="Enter birthdays...">15th ‚Äì Emma S.
28th ‚Äì Jake M.</textarea>
          </div>
          <div class="birthday-month bg-white rounded-xl p-4" style="border: 1px solid color-mix(in oklab, var(--md-coral) 60%, var(--md-white) 40%);">
            <h4 class="font-semibold mb-3">ü¶É November</h4>
            <textarea class="w-full h-20 p-2 text-sm border rounded resize-none teacher-only-edit" disabled placeholder="Enter birthdays...">12th ‚Äì Sarah L.
25th ‚Äì Alex R.</textarea>
          </div>
          <div class="birthday-month bg-white rounded-xl p-4" style="border: 1px solid color-mix(in oklab, var(--md-mustard) 60%, var(--md-white) 40%);">
            <h4 class="font-semibold mb-3">üéÑ December</h4>
            <textarea class="w-full h-20 p-2 text-sm border rounded resize-none teacher-only-edit" disabled placeholder="Enter birthdays...">8th ‚Äì Mia K.
22nd ‚Äì Noah T.</textarea>
          </div>
        </div>
      </div>
    </section>
  </main>
  <footer class="bg-white border-t border-gray-200 mt-16">
    <div class="max-w-6xl mx-auto px-6 py-8">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-gray-600">¬© 2024 Mr. Davis's First Grade Class</p>
        </div>
        <div class="flex gap-3">
          <button id="saveChangesBtn" class="px-4 py-2 rounded-xl font-semibold text-white shadow-soft" style="background: var(--md-coral); display: none;">
            üíæ Save Changes
          </button>
          <button id="editModeBtn" class="px-4 py-2 rounded-xl font-semibold text-white shadow-soft" style="background: var(--md-slate);">
            ‚úèÔ∏è Edit Mode
          </button>
        </div>
      </div>
    </div>
  </footer>
  <div id="pinOverlay" class="fixed inset-0 bg-black/80 flex items-center justify-center" style="z-index: 2000;">
    <div class="bg-white rounded-2xl shadow-soft p-8 max-w-md w-full mx-4">
      <h3 class="text-xl font-display font-bold mb-4 text-center">üîí Teacher Access</h3>
      <p class="text-center text-gray-600 mb-6">Enter your PIN to edit this page</p>
      <div class="space-y-4">
        <input id="pinInput" type="password" placeholder="Enter PIN" class="w-full px-4 py-3 rounded-xl border text-center text-lg">
        <div class="flex gap-3">
          <button id="pinCancel" class="flex-1 px-4 py-3 rounded-xl border font-semibold">Cancel</button>
          <button id="pinSubmit" class="flex-1 px-4 py-3 rounded-xl font-semibold text-white" style="background: var(--md-slate);">Enter</button>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Tab navigation
    function showPage(pageId) {
      document.querySelectorAll('.pagePanel').forEach(panel => {
        panel.classList.remove('active','visible');
        if(panel.dataset.pagePanel === pageId){
          panel.classList.add('active');
          setTimeout(()=>panel.classList.add('visible'),10);
        }
      });
      document.querySelectorAll('.pageTab').forEach(btn => {
        btn.classList.remove('active','ring-4','ring-white/40');
        if(btn.dataset.page === pageId){
          btn.classList.add('active','ring-4','ring-white/40');
        }
      });
    }
    document.addEventListener('DOMContentLoaded',function(){
      showPage('home');
      document.querySelectorAll('.pageTab').forEach(btn=>{
        btn.addEventListener('click',function(e){
          e.preventDefault();
          showPage(btn.dataset.page);
        });
      });
      // Edit Mode PIN overlay logic
      const TEACHER_PIN = '2213';
      document.getElementById('editModeBtn').onclick = function() {
        document.getElementById('pinOverlay').classList.add('show');
        document.getElementById('pinInput').focus();
      };
      document.getElementById('pinCancel').onclick = function() {
        document.getElementById('pinOverlay').classList.remove('show');
        document.getElementById('pinInput').value = '';
      };
      document.getElementById('pinSubmit').onclick = function() {
        var pin = document.getElementById('pinInput').value;
        if(pin === TEACHER_PIN){
          enterEditMode();
          document.getElementById('pinOverlay').classList.remove('show');
        }else{
          document.getElementById('pinInput').style.borderColor='#ef4444';
          setTimeout(()=>{document.getElementById('pinInput').style.borderColor='';},900);
        }
      };
      // Light/Dark toggle
      document.getElementById('toggleHighContrast').onclick=function(){
        document.body.classList.toggle('dark');
      };
      
      // Save Changes button
      document.getElementById('saveChangesBtn').onclick = saveChangesToFirestore;
    });
    
    // Track original values for change detection
    let originalValues = {};
    
    function storeOriginalValues() {
      originalValues = {};
      document.querySelectorAll('[data-edit="teacher"]').forEach((el, index) => {
        const key = `element_${index}`;
        if (el.tagName === 'UL') {
          // For lists, store the inner HTML
          originalValues[key] = el.innerHTML;
        } else {
          // For text content
          originalValues[key] = el.textContent || el.innerText || '';
        }
      });
    }
    
    function hasChanges() {
      let hasChanges = false;
      document.querySelectorAll('[data-edit="teacher"]').forEach((el, index) => {
        const key = `element_${index}`;
        const originalValue = originalValues[key] || '';
        let currentValue = '';
        
        if (el.tagName === 'UL') {
          currentValue = el.innerHTML;
        } else {
          currentValue = el.textContent || el.innerText || '';
        }
        
        if (originalValue !== currentValue) {
          hasChanges = true;
        }
      });
      return hasChanges;
    }
    
    function enterEditMode(){
      storeOriginalValues();
      document.body.classList.add('editing');
      document.querySelectorAll('[data-edit="teacher"]').forEach(el=>el.contentEditable=true);
      document.querySelectorAll('.teacher-only-edit').forEach(el=>{el.disabled=false;el.readOnly=false;});
      document.getElementById('editModeBtn').textContent = 'üíæ Exit Edit Mode';
      document.getElementById('editModeBtn').onclick = exitEditMode;
    }
    function exitEditMode(){
      document.body.classList.remove('editing');
      document.querySelectorAll('[data-edit="teacher"]').forEach(el=>el.contentEditable=false);
      document.querySelectorAll('.teacher-only-edit').forEach(el=>{el.disabled=true;el.readOnly=true;});
      document.getElementById('editModeBtn').textContent = '‚úèÔ∏è Edit Mode';
      document.getElementById('editModeBtn').onclick = function(){
        document.getElementById('pinOverlay').classList.add('show');
        document.getElementById('pinInput').focus();
      };
      
      // Check for changes and show/hide save button
      const saveBtn = document.getElementById('saveChangesBtn');
      if (hasChanges()) {
        saveBtn.style.display = 'block';
      } else {
        saveBtn.style.display = 'none';
      }
    }
    function collectEditableFieldData() {
      const data = {};
      
      // Week text
      const weekEl = document.getElementById('weekText');
      if (weekEl) data.week = weekEl.textContent || '';
      
      // Recap text
      const recapEl = document.getElementById('recapText');
      if (recapEl) data.recap = recapEl.textContent || '';
      
      // Events list - collect all event items
      const eventsContainer = document.getElementById('eventsList');
      if (eventsContainer) {
        const events = [];
        eventsContainer.querySelectorAll('.event-item').forEach(item => {
          const emoji = item.querySelector('.event-emoji')?.textContent || '';
          const text = item.querySelector('.event-text')?.textContent || '';
          if (text) {
            events.push({ icon: emoji, text: text });
          }
        });
        data.dates_json = JSON.stringify(events);
      }
      
      // Looking ahead items
      const lookingAheadSection = Array.from(document.querySelectorAll('div.rounded-2xl')).find(div =>
        div.querySelector('h3') && div.querySelector('h3').textContent.includes('Looking Ahead')
      );
      if (lookingAheadSection) {
        const ul = lookingAheadSection.querySelector('ul[data-edit="teacher"]');
        if (ul) {
          const items = Array.from(ul.querySelectorAll('li')).map(li => li.textContent.replace(/^‚Ä¢\s*/, ''));
          data.looking_ahead = items.join('\n');
        }
      }
      
      // Snacks grid - collect snack items  
      const snacksGrid = document.querySelector('.grid.grid-cols-1.gap-3');
      if (snacksGrid) {
        const snacks = [];
        snacksGrid.querySelectorAll('.grid.grid-cols-\\[auto_1fr\\].gap-2').forEach(item => {
          const emoji = item.querySelector('span:first-child')?.textContent || '';
          const name = item.querySelector('span:nth-child(2)')?.textContent || '';
          if (name) {
            snacks.push({ emoji: emoji, name: name });
          }
        });
        data.snacks_json = JSON.stringify(snacks);
      }
      
      // Scholar info
      const scholarNameEl = document.querySelector('[data-page-panel="scholar"] h3[data-edit="teacher"]');
      if (scholarNameEl) data.scholar_name = scholarNameEl.textContent || '';
      
      const scholarBlurbEl = document.querySelector('[data-page-panel="scholar"] p[data-edit="teacher"]');
      if (scholarBlurbEl) data.scholar_blurb = scholarBlurbEl.textContent || '';
      
      // Skills section
      const skillsDescEl = document.querySelector('[data-page-panel="skills"] p[data-edit="teacher"]');
      if (skillsDescEl) data.skills_text = skillsDescEl.textContent || '';
      
      const skillsUl = document.querySelector('[data-page-panel="skills"] ul[data-edit="teacher"]');
      if (skillsUl) {
        const sounds = Array.from(skillsUl.querySelectorAll('li')).map(li => li.textContent);
        data.sounds_json = JSON.stringify(sounds);
      }
      
      // Listening section
      const listeningDescEl = document.querySelector('[data-page-panel="listening"] p[data-edit="teacher"]');
      if (listeningDescEl) data.listening_text = listeningDescEl.textContent || '';
      
      const listeningUl = document.querySelector('[data-page-panel="listening"] ul[data-edit="teacher"]');
      if (listeningUl) {
        const asks = Array.from(listeningUl.querySelectorAll('li')).map(li => li.textContent);
        data.ask_json = JSON.stringify(asks);
      }
      
      // Math section
      const mathDescEl = document.querySelector('[data-page-panel="math"] p[data-edit="teacher"]');
      if (mathDescEl) data.math_text = mathDescEl.textContent || '';
      
      const mathUl = document.querySelector('[data-page-panel="math"] ul[data-edit="teacher"]');
      if (mathUl) {
        const vocab = Array.from(mathUl.querySelectorAll('li')).map(li => li.textContent);
        data.math_vocab_json = JSON.stringify(vocab);
      }
      
      // Calendar URL
      const calendarLink = document.getElementById('schoolCalendarLink');
      if (calendarLink) data.calendar_url = calendarLink.href || '';
      
      // Photo cards URLs
      const photoCards = document.querySelectorAll('.photo-card');
      const photoUrls = [];
      photoCards.forEach(card => {
        const url = card.getAttribute('data-photo-url') || '';
        photoUrls.push(url);
      });
      data.photo_urls_json = JSON.stringify(photoUrls);
      
      // Gallery photos URLs
      const galleries = {};
      ['art', 'stem', 'gym', 'music'].forEach(type => {
        const galleryEl = document.querySelector(`[data-gallery-type="${type}"]`);
        if (galleryEl) {
          galleries[type] = galleryEl.getAttribute('data-gallery-url') || '';
        }
      });
      data.gallery_urls_json = JSON.stringify(galleries);
      
      return data;
    }
    
    async function saveChangesToFirestore() {
      const saveBtn = document.getElementById('saveChangesBtn');
      const originalText = saveBtn.textContent;
      
      try {
        // Show saving state
        saveBtn.textContent = '‚è≥ Saving...';
        saveBtn.disabled = true;
        
        // Collect all editable field data
        const data = collectEditableFieldData();
        
        // Save to Firestore
        await db.collection('classData').doc('current').set(data, { merge: true });
        
        // Show success state
        saveBtn.textContent = '‚úÖ Saved!';
        
        // Reload data from Firestore
        setTimeout(async () => {
          const updatedData = await fetchFirestoreData();
          populateDataFromSheet(updatedData);
          
          // Hide save button and reset original values
          saveBtn.style.display = 'none';
          saveBtn.textContent = originalText;
          saveBtn.disabled = false;
          originalValues = {};
        }, 1000);
        
      } catch (error) {
        console.error('Failed to save changes:', error);
        saveBtn.textContent = '‚ùå Save Failed';
        setTimeout(() => {
          saveBtn.textContent = originalText;
          saveBtn.disabled = false;
        }, 2000);
      }
    }
    
    // Home tab: Add event
    function addEvent() {
      // Create event directly editable on the page instead of using prompts
      const div = document.createElement('div');
      div.className = 'event-item flex items-center gap-3 p-3 rounded-xl bg-yellow-50 border';
      div.style.borderColor = 'var(--md-mustard)';
      div.innerHTML = `
        <span class="event-emoji text-xl" data-edit="teacher" contenteditable="true">üéâ</span>
        <span class="event-text font-semibold flex-1" data-edit="teacher" contenteditable="true">Click to edit event</span>
        <button class="edit-only text-red-500 hover:text-red-700" onclick="this.parentNode.remove()">‚úñ</button>
      `;
      document.getElementById('eventsList').appendChild(div);
      
      // Auto-focus the text field for immediate editing
      const textSpan = div.querySelector('.event-text');
      textSpan.focus();
      textSpan.select();
    }
    // Home tab: Add snack
    function addSnackItem() {
      const snackName = prompt('Enter snack name:');
      const emoji = prompt('Enter emoji (optional):') || 'üçé';
      if (snackName) {
        const newSnack = document.createElement('div');
        newSnack.className = 'p-4 rounded-xl bg-white';
        newSnack.style.border = '1px solid color-mix(in oklab, var(--md-slate) 35%, var(--md-white) 65%)';
        newSnack.innerHTML = `
          <div class="flex items-center gap-3 mb-3">
            <input type="checkbox" class="w-4 h-4 snack-check">
            <span class="text-xl">${emoji}</span>
            <span class="font-medium">${snackName}</span>
          </div>
          <div class="flex items-center gap-2">
            <input type="text" placeholder="Your name" class="flex-1 px-3 py-2 rounded-lg text-sm snack-name" style="background: var(--md-cream);">
            <button class="px-3 py-2 rounded-lg text-white text-sm font-semibold" style="background: var(--md-coral);" onclick="claimSnack(this)">Save</button>
            <button class="text-gray-400 hover:text-red-500" onclick="this.closest('.p-4').remove()">‚úñ</button>
          </div>
        `;
        document.getElementById('snacksGrid').appendChild(newSnack);
      }
    }
    // Snack claim
    function claimSnack(btn) {
      const card = btn.closest('.p-4');
      const name = card.querySelector('.snack-name').value.trim();
      if (name) {
        card.classList.add('snack-claimed');
        btn.textContent = 'Saved!';
        setTimeout(()=>{btn.textContent='Save';},1800);
      } else {
        card.classList.remove('snack-claimed');
      }
    }
    // Extras tab: Add card
    function addExtrasCard() {
      // Create card directly editable on the page instead of using prompts
      const newCard = document.createElement('div');
      newCard.className = 'text-center p-8 rounded-2xl';
      newCard.style.background = 'color-mix(in oklab, var(--md-white) 70%, var(--md-mustard) 30%)';
      newCard.style.border = '1px solid color-mix(in oklab, var(--md-mustard) 60%, var(--md-white) 40%)';
      newCard.innerHTML = `
        <div class="text-6xl mb-4 emoji-edit" data-edit="teacher" contenteditable="true">‚ú®</div>
        <h3 class="font-semibold mb-2" data-edit="teacher" contenteditable="true">Click to edit title</h3>
        <p class="text-sm" data-edit="teacher" contenteditable="true">Click to edit description</p>
        <button class="edit-only mt-2 text-red-500 hover:text-red-700 text-xs" onclick="this.closest('.text-center').remove();">Remove Card</button>
      `;
      document.getElementById('extrasGrid').appendChild(newCard);
      
      // Auto-focus the title for immediate editing
      const titleEl = newCard.querySelector('h3');
      titleEl.focus();
      titleEl.select();
    }
    // Specials galleries: dummy swipe
    function prevGalleryImg(btn) {
      alert("Gallery swipe feature coming soon!");
    }
    function nextGalleryImg(btn) {
      alert("Gallery swipe feature coming soon!");
    }
    // Editable photo cards: file upload functionality
    function editPhoto(el) {
      // Only allow editing in edit mode
      if (!document.body.classList.contains('editing')) {
        return;
      }
      
      // Create file input
      const fileInput = document.createElement('input');
      fileInput.type = 'file';
      fileInput.accept = 'image/*';
      fileInput.style.display = 'none';
      
      fileInput.onchange = async function(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        try {
          // Show loading state
          el.innerHTML = '‚è≥';
          el.style.pointerEvents = 'none';
          
          // Generate unique filename
          const timestamp = Date.now();
          const fileName = `photo_${timestamp}_${file.name}`;
          
          // Upload to Firebase Storage
          const storageRef = storage.ref(`photos/${fileName}`);
          const uploadTask = await storageRef.put(file);
          const downloadURL = await uploadTask.ref.getDownloadURL();
          
          // Update the photo card display
          updatePhotoCardDisplay(el, downloadURL);
          
          // Store the photo URL in the element for later collection
          el.setAttribute('data-photo-url', downloadURL);
          
          // Show save button since we have changes
          const saveBtn = document.getElementById('saveChangesBtn');
          if (saveBtn) saveBtn.style.display = 'block';
          
        } catch (error) {
          console.error('Failed to upload photo:', error);
          alert('Failed to upload photo. Please try again.');
          // Reset to plus icon on error
          el.innerHTML = '+';
        }
        
        el.style.pointerEvents = 'auto';
        document.body.removeChild(fileInput);
      };
      
      document.body.appendChild(fileInput);
      fileInput.click();
    }
    
    // Helper function to update photo card display
    function updatePhotoCardDisplay(element, imageUrl) {
      element.innerHTML = `<img src="${imageUrl}" alt="Uploaded photo" style="width: 100%; height: 100%; object-fit: cover; border-radius: inherit;">`;
    }
    
    // Gallery photo upload functionality
    function editGalleryPhoto(el, galleryType) {
      // Only allow editing in edit mode
      if (!document.body.classList.contains('editing')) {
        return;
      }
      
      // Create file input
      const fileInput = document.createElement('input');
      fileInput.type = 'file';
      fileInput.accept = 'image/*';
      fileInput.style.display = 'none';
      
      fileInput.onchange = async function(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        try {
          // Show loading state
          const originalContent = el.innerHTML;
          el.innerHTML = '<span class="text-3xl text-gray-400">‚è≥</span>';
          el.style.pointerEvents = 'none';
          
          // Generate unique filename
          const timestamp = Date.now();
          const fileName = `gallery_${galleryType}_${timestamp}_${file.name}`;
          
          // Upload to Firebase Storage
          const storageRef = storage.ref(`galleries/${fileName}`);
          const uploadTask = await storageRef.put(file);
          const downloadURL = await uploadTask.ref.getDownloadURL();
          
          // Update the gallery display
          updateGalleryDisplay(el, downloadURL);
          
          // Store the photo URL in the element for later collection
          el.setAttribute('data-gallery-url', downloadURL);
          
          // Show save button since we have changes
          const saveBtn = document.getElementById('saveChangesBtn');
          if (saveBtn) saveBtn.style.display = 'block';
          
        } catch (error) {
          console.error('Failed to upload gallery photo:', error);
          alert('Failed to upload photo. Please try again.');
          // Reset to plus icon on error
          el.innerHTML = '<span class="text-3xl text-gray-400">+</span>';
        }
        
        el.style.pointerEvents = 'auto';
        document.body.removeChild(fileInput);
      };
      
      document.body.appendChild(fileInput);
      fileInput.click();
    }
    
    // Helper function to update gallery display
    function updateGalleryDisplay(element, imageUrl) {
      const img = element.querySelector('img');
      const plusSpan = element.querySelector('span');
      
      if (img && plusSpan) {
        img.src = imageUrl;
        img.style.display = 'block';
        img.style.width = '100%';
        img.style.height = '100%';
        img.style.objectFit = 'cover';
        plusSpan.style.display = 'none';
      }
    }
    // School calendar link edit
    function editSchoolCalendarLink(event, linkElement) {
      if (document.body.classList.contains('editing')) {
        event.preventDefault();
        const newUrl = prompt('Enter school calendar URL:', linkElement.href);
        if (newUrl) linkElement.href = newUrl;
      }
    }
  </script>

  <!-- Firebase Firestore Integration Script -->
  <script>
// Utility: Parse JSON fields from string or array
function parseArray(val) {
  if (!val) return [];
  if (Array.isArray(val)) return val;
  try { return JSON.parse(val); } catch { return []; }
}

// --- Section Updaters (these match your new sheet keys) ---
function updateWeekText(week) {
  const el = document.getElementById('weekText');
  if (el && week) el.textContent = week;
}
function updateRecapText(recap) {
  const el = document.getElementById('recapText');
  if (el && recap) el.textContent = recap;
}
function updateEventsList(dates_json) {
  const eventsContainer = document.getElementById('eventsList');
  if (!eventsContainer) return;
  const arr = parseArray(dates_json);
  eventsContainer.innerHTML = '';
  arr.forEach(ev => {
    const icon = ev.icon || 'üìå';
    const text = ev.text || '';
    const div = document.createElement('div');
    div.className = 'event-item flex items-center gap-3 p-3 rounded-xl bg-yellow-50 border';
    div.style.borderColor = 'var(--md-mustard)';
    div.innerHTML = `
      <span class="event-emoji text-xl" data-edit="teacher" contenteditable="false">${icon}</span>
      <span class="event-text font-semibold flex-1" data-edit="teacher" contenteditable="false">${text}</span>
      <button class="edit-only text-red-500 hover:text-red-700" onclick="this.parentNode.remove()">‚úñ</button>
    `;
    eventsContainer.appendChild(div);
  });
}
function updateLookingAhead(lookingAhead) {
  const section = Array.from(document.querySelectorAll('div.rounded-2xl')).find(div =>
    div.querySelector('h3') && div.querySelector('h3').textContent.includes('Looking Ahead')
  );
  if (!section) return;
  const ul = section.querySelector('ul[data-edit="teacher"]');
  if (!ul) return;
  let arr = [];
  if (Array.isArray(lookingAhead)) arr = lookingAhead;
  else if (typeof lookingAhead === 'string') arr = lookingAhead.split(/\r?\n/).filter(x=>x.trim());
  ul.innerHTML = '';
  arr.forEach(item => {
    const li = document.createElement('li');
    li.textContent = '‚Ä¢ ' + item;
    ul.appendChild(li);
  });
}
function updateSnacksGrid(snacks_json) {
  const snacksContainer = document.getElementById('snacksGrid');
  if (!snacksContainer) return;
  const arr = parseArray(snacks_json);
  snacksContainer.innerHTML = '';
  arr.forEach(snack => {
    const emoji = snack.emoji || 'üçé';
    const item = snack.item || '';
    const claimed = snack.claimed_by || '';
    const div = document.createElement('div');
    div.className = 'p-4 rounded-xl bg-white';
    div.style.border = '1px solid color-mix(in oklab, var(--md-slate) 35%, var(--md-white) 65%)';
    div.innerHTML = `
      <div class="flex items-center gap-3 mb-3">
        <input type="checkbox" class="w-4 h-4 snack-check" ${claimed ? 'checked' : ''}>
        <span class="text-xl">${emoji}</span>
        <span class="font-medium">${item}</span>
      </div>
      <div class="flex items-center gap-2">
        <input type="text" placeholder="Your name" class="flex-1 px-3 py-2 rounded-lg text-sm snack-name" style="background: var(--md-cream);" value="${claimed}">
        <button class="px-3 py-2 rounded-lg text-white text-sm font-semibold" style="background: var(--md-coral);" onclick="claimSnack(this)">Save</button>
        <button class="text-gray-400 hover:text-red-500" onclick="this.closest('.p-4').remove()">‚úñ</button>
      </div>
    `;
    snacksContainer.appendChild(div);
  });
}
function updateScholarInfo(scholar_name, scholar_blurb) {
  const nameEl = document.querySelector('[data-page-panel="scholar"] h3[data-edit="teacher"]');
  const descEl = document.querySelector('[data-page-panel="scholar"] p[data-edit="teacher"]');
  if (nameEl && scholar_name) nameEl.textContent = scholar_name;
  if (descEl && scholar_blurb) descEl.textContent = scholar_blurb;
}
function updateSkillsSection(skills_text, sounds_json) {
  const descEl = document.querySelector('[data-page-panel="skills"] p[data-edit="teacher"]');
  const vocabUl = document.querySelector('[data-page-panel="skills"] ul[data-edit="teacher"]');
  if (descEl && skills_text) descEl.textContent = skills_text;
  if (vocabUl && sounds_json) {
    const arr = parseArray(sounds_json);
    vocabUl.innerHTML = '';
    arr.forEach(item => {
      const li = document.createElement('li');
      li.textContent = item;
      vocabUl.appendChild(li);
    });
  }
}
function updateListeningSection(listening_text, ask_json) {
  const descEl = document.querySelector('[data-page-panel="listening"] p[data-edit="teacher"]');
  const ul = document.querySelector('[data-page-panel="listening"] ul[data-edit="teacher"]');
  if (descEl && listening_text) descEl.textContent = listening_text;
  if (ul && ask_json) {
    const arr = parseArray(ask_json);
    ul.innerHTML = '';
    arr.forEach(item => {
      const li = document.createElement('li');
      li.textContent = item;
      ul.appendChild(li);
    });
  }
}
function updateMathSection(math_text, math_vocab_json) {
  const descEl = document.querySelector('[data-page-panel="math"] p[data-edit="teacher"]');
  const ul = document.querySelector('[data-page-panel="math"] ul[data-edit="teacher"]');
  if (descEl && math_text) descEl.textContent = math_text;
  if (ul && math_vocab_json) {
    const arr = parseArray(math_vocab_json);
    ul.innerHTML = '';
    arr.forEach(item => {
      const li = document.createElement('li');
      li.textContent = item;
      ul.appendChild(li);
    });
  }
}
function updateExtrasSection(extras_json) {
  const extrasContainer = document.getElementById('extrasGrid');
  if (!extrasContainer) return;
  const arr = parseArray(extras_json);
  extrasContainer.innerHTML = '';
  arr.forEach(extra => {
    const emoji = extra.emoji || '‚ú®';
    const title = extra.title || '';
    const body_html = extra.body_html || '';
    const div = document.createElement('div');
    div.className = 'text-center p-8 rounded-2xl';
    div.style.background = 'color-mix(in oklab, var(--md-white) 70%, var(--md-mustard) 30%)';
    div.style.border = '1px solid color-mix(in oklab, var(--md-mustard) 60%, var(--md-white) 40%)';
    div.innerHTML = `
      <div class="text-6xl mb-4 emoji-edit" data-edit="teacher" contenteditable="false">${emoji}</div>
      <h3 class="font-semibold mb-2" data-edit="teacher" contenteditable="false">${title}</h3>
      <p class="text-sm" data-edit="teacher" contenteditable="false">${body_html}</p>
      <button class="edit-only mt-2 text-red-500 hover:text-red-700 text-xs" onclick="this.closest('.text-center').remove();">Remove Card</button>
    `;
    extrasContainer.appendChild(div);
  });
}
function updateAboutMeSection(data) {
  if (!data) return;
  const cards = document.querySelectorAll('[data-page-panel="aboutme"] .text-xs[data-edit="teacher"]');
  if (cards.length >= 4) {
    if (data.favorite_color) cards[0].textContent = data.favorite_color;
    if (data.favorite_snack) cards[1].textContent = data.favorite_snack;
    if (data.favorite_drink) cards[2].textContent = data.favorite_drink;
    if (data.favorite_show)  cards[3].textContent = data.favorite_show;
  }
  const aboutDesc = document.querySelector('[data-page-panel="aboutme"] p[data-edit="teacher"]');
  if (aboutDesc && data.about_me_html) {
    aboutDesc.innerHTML = data.about_me_html;
  }
  const factsUl = document.querySelector('[data-page-panel="aboutme"] ul[data-edit="teacher"]');
  if (factsUl && data.fun_facts_html) {
    if (Array.isArray(data.fun_facts_html)) {
      factsUl.innerHTML = '';
      data.fun_facts_html.forEach(fact => {
        const li = document.createElement('li');
        li.textContent = fact;
        factsUl.appendChild(li);
      });
    } else {
      factsUl.innerHTML = data.fun_facts_html;
    }
  }
}
function populateDataFromSheet(data) {
  if (!data) return;
  updateWeekText(data.week);
  updateRecapText(data.recap);
  updateEventsList(data.dates_json);
  updateLookingAhead(data.looking_ahead);
  updateSnacksGrid(data.snacks_json);
  updateScholarInfo(data.scholar_name, data.scholar_blurb);
  updateSkillsSection(data.skills_text, data.sounds_json);
  updateListeningSection(data.listening_text, data.ask_json);
  updateMathSection(data.math_text, data.math_vocab_json);
  updateExtrasSection(data.extras_json);
  updateAboutMeSection(data);
  
  // Load photo cards
  updatePhotoCards(data.photo_urls_json);
  
  // Load gallery photos
  updateGalleryPhotos(data.gallery_urls_json);
  
  if (data.calendar_url) {
    const cal = document.getElementById('schoolCalendarLink');
    if (cal) cal.href = data.calendar_url;
  }
}

// Function to update photo cards with saved URLs
function updatePhotoCards(photoUrlsJson) {
  if (!photoUrlsJson) return;
  
  let photoUrls = [];
  try {
    photoUrls = JSON.parse(photoUrlsJson);
  } catch (e) {
    console.error('Failed to parse photo URLs:', e);
    return;
  }
  
  const photoCards = document.querySelectorAll('.photo-card');
  photoCards.forEach((card, index) => {
    const url = photoUrls[index];
    if (url) {
      card.setAttribute('data-photo-url', url);
      updatePhotoCardDisplay(card, url);
    }
  });
}

// Function to update gallery photos with saved URLs
function updateGalleryPhotos(galleryUrlsJson) {
  if (!galleryUrlsJson) return;
  
  let galleryUrls = {};
  try {
    galleryUrls = JSON.parse(galleryUrlsJson);
  } catch (e) {
    console.error('Failed to parse gallery URLs:', e);
    return;
  }
  
  ['art', 'stem', 'gym', 'music'].forEach(type => {
    const url = galleryUrls[type];
    if (url) {
      const galleryEl = document.querySelector(`[data-gallery-type="${type}"]`);
      if (galleryEl) {
        galleryEl.setAttribute('data-gallery-url', url);
        updateGalleryDisplay(galleryEl, url);
      }
    }
  });
}

async function fetchFirestoreData() {
  try {
    const doc = await db.collection('classData').doc('current').get();
    if (doc.exists) {
      return doc.data();
    } else {
      console.log('No document found, using defaults');
      return null;
    }
  } catch (e) {
    console.error('Failed to fetch Firestore data:', e);
    return null;
  }
}
document.addEventListener('DOMContentLoaded', function() {
  setTimeout(async () => {
    const data = await fetchFirestoreData();
    populateDataFromSheet(data);
  }, 350);
});
setInterval(async () => {
  const data = await fetchFirestoreData();
  populateDataFromSheet(data);
}, 300000);

// New JavaScript functions for enhanced functionality

// Profile photo upload functionality
function editProfilePhoto(el, section) {
  // Only allow editing in edit mode
  if (!document.body.classList.contains('editing')) {
    return;
  }
  
  // Create file input
  const fileInput = document.createElement('input');
  fileInput.type = 'file';
  fileInput.accept = 'image/*';
  fileInput.style.display = 'none';
  
  fileInput.onchange = async function(e) {
    const file = e.target.files[0];
    if (!file) return;
    
    try {
      // Show loading state
      el.innerHTML = '‚è≥';
      el.style.pointerEvents = 'none';
      
      // Generate unique filename
      const timestamp = Date.now();
      const fileName = `profile_${section}_${timestamp}_${file.name}`;
      
      // Upload to Firebase Storage
      const storageRef = storage.ref(`profiles/${fileName}`);
      const uploadTask = await storageRef.put(file);
      const downloadURL = await uploadTask.ref.getDownloadURL();
      
      // Update the display
      el.innerHTML = `<img src="${downloadURL}" alt="Profile" style="width:100%; height:100%; object-fit:cover;">`;
      el.style.pointerEvents = 'auto';
      
      // Store the photo URL for later collection
      el.setAttribute('data-profile-url', downloadURL);
      
      // Show save button since we have changes
      const saveBtn = document.getElementById('saveChangesBtn');
      if (saveBtn) saveBtn.style.display = 'block';
      
    } catch (error) {
      console.error('Failed to upload profile photo:', error);
      alert('Failed to upload photo. Please try again.');
      // Reset on error
      el.innerHTML = '';
      el.style.pointerEvents = 'auto';
    }
    
    document.body.removeChild(fileInput);
  };
  
  document.body.appendChild(fileInput);
  fileInput.click();
}

// Confetti animation for celebrate button
function triggerConfetti() {
  // Create confetti container
  const confettiContainer = document.createElement('div');
  confettiContainer.style.position = 'fixed';
  confettiContainer.style.top = '0';
  confettiContainer.style.left = '0';
  confettiContainer.style.width = '100%';
  confettiContainer.style.height = '100%';
  confettiContainer.style.pointerEvents = 'none';
  confettiContainer.style.zIndex = '9999';
  
  // Create multiple confetti pieces
  const colors = ['#E0B14A', '#E9867D', '#F2C9BE', '#7B8E9E'];
  const emojis = ['üéâ', 'üåü', '‚ú®', 'üéä', 'üéà'];
  
  for (let i = 0; i < 50; i++) {
    const confetti = document.createElement('div');
    confetti.style.position = 'absolute';
    confetti.style.fontSize = '20px';
    confetti.style.left = Math.random() * 100 + '%';
    confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
    confetti.style.animationDelay = Math.random() * 2 + 's';
    confetti.textContent = emojis[Math.floor(Math.random() * emojis.length)];
    
    // Add falling animation
    confetti.style.animation = 'confettiFall 3s linear forwards';
    
    confettiContainer.appendChild(confetti);
  }
  
  document.body.appendChild(confettiContainer);
  
  // Remove confetti after animation
  setTimeout(() => {
    document.body.removeChild(confettiContainer);
  }, 5000);
}

// Website URL update functionality  
function updateWebsiteUrl(input) {
  const websiteCard = input.closest('.website-card');
  const link = websiteCard.querySelector('.website-link');
  if (link && input.value) {
    link.href = input.value;
    
    // Show save button since we have changes
    const saveBtn = document.getElementById('saveChangesBtn');
    if (saveBtn) saveBtn.style.display = 'block';
  }
}

// Add CSS for confetti animation
const style = document.createElement('style');
style.textContent = `
  @keyframes confettiFall {
    0% {
      transform: translateY(-100vh) rotate(0deg);
      opacity: 1;
    }
    100% {
      transform: translateY(100vh) rotate(720deg);
      opacity: 0;
    }
  }
`;
document.head.appendChild(style);
  </script>
</body>
</html>
