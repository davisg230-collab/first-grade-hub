<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hey Hey First Grade! - Mr. Davis's Class</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            display: ['"Poppins"','ui-sans-serif','system-ui'],
            body: ['"Inter"','ui-sans-serif','system-ui'],
          },
          colors: {
            brand: {
              mustard:'#E0B14A', slate:'#7B8E9E', coral:'#E9867D',
              blush:'#F2C9BE', cream:'#F7EFE2', pebble:'#E6D5B8',
              ink:'#2B2B2B', white:'#FFFFFF'
            }
          },
          boxShadow:{ soft:'0 10px 30px rgba(43,43,43,0.10)' }
        }
      }
    };
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Poppins:wght@600;700;800&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBVFcyBYlz3DmCkOervIswwjPf6wwFZlhU",
      authDomain: "first-grade-news-hub.firebaseapp.com",
      projectId: "first-grade-news-hub",
      storageBucket: "first-grade-news-hub.firebasestorage.app",
      messagingSenderId: "472215115326",
      appId: "1:472215115326:web:0d1f2cb7c1d5615676636f",
      measurementId: "G-5SF4RE6KLS"
    };
    // Initialize Firebase with error handling
    let db, auth, storage;
    try {
      firebase.initializeApp(firebaseConfig);
      try { firebase.analytics(); } catch (e) { console.warn('Firebase analytics failed:', e); }
      db = firebase.firestore();
      auth = firebase.auth();
      storage = firebase.storage();
      console.log('Firebase initialized successfully');
    } catch (e) {
      console.error('Firebase initialization failed:', e);
      // Set db to undefined so we can check for it later
      db = undefined;
      auth = undefined;
      storage = undefined;
    }
    // Helper function to check authentication before Firestore writes
    async function ensureAuthenticated() {
      if (!auth) {
        throw new Error('Firebase authentication not available');
      }
      if (!auth.currentUser) {
        throw new Error('User not authenticated. Please enter edit mode first.');
      }
      return true;
    }
  </script>
  <style>
    :root{
      --md-mustard:#E0B14A; --md-slate:#7B8E9E; --md-coral:#E9867D;
      --md-blush:#F2C9BE; --md-cream:#F7EFE2; --md-pebble:#E6D5B8;
      --md-ink:#2B2B2B; --md-white:#FFFFFF;
      --hdr-bg: var(--md-mustard);
      --card-bg: var(--md-cream);
    }
    /* ... rest of style unchanged ... */
  </style>
</head>
<body class="bg-[color:var(--md-cream)] text-[color:var(--md-ink)] font-body">
  <!-- ... rest of HTML unchanged ... -->
  <script>
    // ...other logic...
    async function enterEditMode() {
      // Authenticate with Firebase using Google Sign-in before enabling edit mode
      try {
        if (auth && !auth.currentUser) {
          const provider = new firebase.auth.GoogleAuthProvider();
          await auth.signInWithPopup(provider);
          console.log('Google sign-in successful');
        } else if (auth && auth.currentUser) {
          console.log('Already authenticated with Firebase');
        } else {
          console.error('Firebase auth not available');
          alert('Authentication failed. Please refresh the page and try again.');
          return;
        }
      } catch (error) {
        console.error('Google authentication failed:', error);
        alert('Authentication failed: ' + error.message);
        return;
      }
      // ...rest of your enterEditMode logic...
      storeOriginalValues();
      document.body.classList.add('editing');
      document.querySelectorAll('[data-edit="teacher"]').forEach(el=>el.contentEditable=true);
      document.querySelectorAll('.teacher-only-edit').forEach(el=>{el.disabled=false;el.readOnly=false;});
      // Enable snack message textarea and show edit controls
      const snackMessage = document.getElementById('snackMessage');
      if (snackMessage) {
        snackMessage.disabled = false;
        snackMessage.readOnly = false;
      }
      // Show edit-only elements
      document.querySelectorAll('.edit-only').forEach(el => {
        el.style.display = '';
      });
      // ...rest of your logic...
    }
  </script>
</body>
</html>
